<!DOCTYPE html>
<html style="height: 100%">
<head>
	<title>Map Selector</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="leaflet.css" />
	
	<script type="text/javascript" src="gpc.js"></script>
	<script src="leaflet.js"></script>
<style>

button {
    background: white none repeat scroll 0 0;
    border: 0 none;
    border-radius: 0;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
    font-family: trebuchet ms;
    font-weight: bold;
    margin: 0 4px 0 0;
    padding: 4px 8px;
    z-index: 80;
}
</style>

</head>
<body style="margin:0;height: 100%">
<!--
<canvas id="canvas" height="300" width="300"></canvas>
<br />

-->


<div id="front" style="position: absolute; top: 10px; left: 45px; z-index: 80;">
<button id="union">Union</button>
<button id="diff">Difference</button>
<button id="undo">Undo</button>
<button id="export">Export</button>
</div>

<div id="map" style="width: 100%; height: 100%"></div>
	
<script>

data = [{"x":2.8564453125,"y":51.20688339486562},{"x":1.636962890625,"y":51.20688339486562},{"x":1.636962890625,"y":51.01375465718819},{"x":1.395263671875,"y":51.01375465718819},{"x":1.395263671875,"y":50.792047064406844},{"x":1.23046875,"y":50.792047064406844},{"x":1.23046875,"y":50.14170587960567},{"x":0.6042480468749999,"y":50.14170587960567},{"x":0.6042480468749999,"y":49.993615462541136},{"x":0.24169921874999997,"y":49.993615462541136},{"x":0.24169921874999997,"y":49.85215166776998},{"x":-0.17578125,"y":49.85215166776998},{"x":-0.17578125,"y":49.43241258024849},{"x":-0.9228515625,"y":49.43241258024849},{"x":-0.9228515625,"y":49.85215166776998},{"x":-2.427978515625,"y":49.85215166776998},{"x":-2.427978515625,"y":49.63206194128714},{"x":-2.83447265625,"y":49.63206194128714},{"x":-2.83447265625,"y":49.009050809382046},{"x":-4.15283203125,"y":49.009050809382046},{"x":-4.15283203125,"y":48.857487002645485},{"x":-4.581298828125,"y":48.857487002645485},{"x":-4.581298828125,"y":48.777912755501845},{"x":-5.2294921875,"y":48.777912755501845},{"x":-5.2294921875,"y":47.86108855623181},{"x":-4.6142578125,"y":47.86108855623181},{"x":-4.6142578125,"y":47.52461999690649},{"x":-3.779296875,"y":47.52461999690649},{"x":-3.779296875,"y":47.454094290400015},{"x":-3.4606933593749996,"y":47.454094290400015},{"x":-3.4606933593749996,"y":47.178512264439085},{"x":-2.6861572265625,"y":47.178512264439085},{"x":-2.6861572265625,"y":47.04766864046083},{"x":-2.537841796875,"y":47.04766864046083},{"x":-2.537841796875,"y":46.55130547880643},{"x":-2.109375,"y":46.55130547880643},{"x":-2.109375,"y":46.37346430137335},{"x":-1.8072509765625,"y":46.37346430137335},{"x":-1.8072509765625,"y":46.08466189789017},{"x":-1.58203125,"y":46.08466189789017},{"x":-1.58203125,"y":45.67548217560647},{"x":-1.494140625,"y":45.67548217560647},{"x":-1.494140625,"y":44.190082025040525},{"x":-1.6259765625,"y":44.190082025040525},{"x":-1.6259765625,"y":43.65594991256823},{"x":-2.8070068359375,"y":43.65594991256823},{"x":-2.8070068359375,"y":43.67581809328341},{"x":-4.031982421875,"y":43.67581809328341},{"x":-4.031982421875,"y":43.55252937447483},{"x":-5.1031494140625,"y":43.55252937447483},{"x":-5.1031494140625,"y":43.858296779161826},{"x":-8.646240234375,"y":43.858296779161826},{"x":-8.646240234375,"y":43.476840397778936},{"x":-9.51416015625,"y":43.476840397778936},{"x":-9.51416015625,"y":42.32606244456202},{"x":-9.195556640625,"y":42.32606244456202},{"x":-9.195556640625,"y":41.73852846935917},{"x":-6.78955078125,"y":41.73852846935917},{"x":-6.78955078125,"y":41.16211393939692},{"x":-7.27294921875,"y":41.16211393939692},{"x":-7.27294921875,"y":39.90973623453719},{"x":-7.888183593749999,"y":39.90973623453719},{"x":-7.888183593749999,"y":39.223742741391284},{"x":-7.459716796875001,"y":39.223742741391284},{"x":-7.459716796875001,"y":38.71123253895224},{"x":-7.888183593749999,"y":38.71123253895224},{"x":-7.888183593749999,"y":38.34165619279593},{"x":-7.525634765624999,"y":38.34165619279593},{"x":-7.525634765624999,"y":37.82280243352756},{"x":-7.888183593749999,"y":37.82280243352756},{"x":-7.888183593749999,"y":37.046408899699564},{"x":-7.283935546874999,"y":37.046408899699564},{"x":-7.283935546874999,"y":36.85325222344018},{"x":-6.690673828125,"y":36.85325222344018},{"x":-6.690673828125,"y":36.155617833818525},{"x":-6.317138671875,"y":36.155617833818525},{"x":-6.317138671875,"y":36.08462129606931},{"x":-6.00677490234375,"y":36.08462129606931},{"x":-6.00677490234375,"y":35.875698032496665},{"x":-6.1468505859375,"y":35.875698032496665},{"x":-6.1468505859375,"y":35.66622234103479},{"x":-6.229248046875,"y":35.66622234103479},{"x":-6.229248046875,"y":35.32408937278183},{"x":-6.4324951171875,"y":35.32408937278183},{"x":-6.4324951171875,"y":35.137879119634185},{"x":-6.481933593749999,"y":35.137879119634185},{"x":-6.481933593749999,"y":34.79125047210742},{"x":-6.663208007812499,"y":34.79125047210742},{"x":-6.663208007812499,"y":34.488447837809304},{"x":-6.844482421875,"y":34.488447837809304},{"x":-6.844482421875,"y":34.38877925439018},{"x":-6.951599121093749,"y":34.38877925439018},{"x":-6.951599121093749,"y":34.07996230865873},{"x":-7.311401367187499,"y":34.07996230865873},{"x":-7.311401367187499,"y":33.920571528675076},{"x":-7.646484374999999,"y":33.920571528675076},{"x":-7.646484374999999,"y":33.779147331286474},{"x":-7.976074218749999,"y":33.779147331286474},{"x":-7.976074218749999,"y":33.55970664841198},{"x":-8.690185546875,"y":33.55970664841198},{"x":-8.690185546875,"y":33.32134852669881},{"x":-8.9263916015625,"y":33.32134852669881},{"x":-8.9263916015625,"y":33.01096671579776},{"x":-9.2779541015625,"y":33.01096671579776},{"x":-9.2779541015625,"y":32.78265637602964},{"x":-9.547119140624998,"y":32.78265637602964},{"x":-9.547119140624998,"y":32.14771106595571},{"x":-9.7503662109375,"y":32.14771106595571},{"x":-9.7503662109375,"y":31.788886163788444},{"x":-10.04150390625,"y":31.788886163788444},{"x":-10.04150390625,"y":31.08116546459057},{"x":-10.167846679687498,"y":31.08116546459057},{"x":-10.167846679687498,"y":30.458144351018078},{"x":-9.9920654296875,"y":30.458144351018078},{"x":-9.9920654296875,"y":29.7453016622136},{"x":-10.4150390625,"y":29.7453016622136},{"x":-10.4150390625,"y":29.621221113784504},{"x":-10.6292724609375,"y":29.621221113784504},{"x":-10.6292724609375,"y":29.171348850951507},{"x":-11.09619140625,"y":29.171348850951507},{"x":-11.09619140625,"y":28.998531814051795},{"x":-11.49169921875,"y":28.998531814051795},{"x":-11.49169921875,"y":28.608637026615575},{"x":-11.88720703125,"y":28.608637026615575},{"x":-11.88720703125,"y":28.34306490482549},{"x":-12.557373046874998,"y":28.34306490482549},{"x":-12.557373046874998,"y":28.110748760633534},{"x":-13.18359375,"y":28.110748760633534},{"x":-13.18359375,"y":26.980828590472107},{"x":-8.459472656249998,"y":26.980828590472107},{"x":-8.459472656249998,"y":28.66167121641951},{"x":-7.8607177734375,"y":28.66167121641951},{"x":-7.8607177734375,"y":29.017748018496047},{"x":-7.174072265624999,"y":29.017748018496047},{"x":-7.174072265624999,"y":29.334298230315675},{"x":-5.27069091796875,"y":29.334298230315675},{"x":-5.27069091796875,"y":29.716681287231072},{"x":-5.10040283203125,"y":29.716681287231072},{"x":-5.10040283203125,"y":29.92399377762769},{"x":-4.866943359375,"y":29.92399377762769},{"x":-4.866943359375,"y":30.012030680358613},{"x":-4.65545654296875,"y":30.012030680358613},{"x":-4.65545654296875,"y":30.209234673510014},{"x":-4.60601806640625,"y":30.209234673510014},{"x":-4.60601806640625,"y":30.247204606534158},{"x":-4.40826416015625,"y":30.247204606534158},{"x":-4.40826416015625,"y":30.391830328088137},{"x":-4.28192138671875,"y":30.391830328088137},{"x":-4.28192138671875,"y":30.519681272749402},{"x":-3.7985229492187496,"y":30.519681272749402},{"x":-3.7985229492187496,"y":30.62373195163005},{"x":-3.53759765625,"y":30.62373195163005},{"x":-3.53759765625,"y":30.859794872560766},{"x":-3.3837890625,"y":30.859794872560766},{"x":-3.3837890625,"y":31.233940186109823},{"x":-3.614501953125,"y":31.233940186109823},{"x":-3.614501953125,"y":31.5504526754715},{"x":-3.5211181640624996,"y":31.5504526754715},{"x":-3.5211181640624996,"y":31.646367146916386},{"x":-3.13385009765625,"y":31.646367146916386},{"x":-3.13385009765625,"y":31.59725256170666},{"x":-2.98004150390625,"y":31.59725256170666},{"x":-2.98004150390625,"y":31.7234948028286},{"x":-2.77130126953125,"y":31.7234948028286},{"x":-2.77130126953125,"y":32.04766089060862},{"x":-2.362060546875,"y":32.04766089060862},{"x":-2.362060546875,"y":32.008075959291055},{"x":-1.1260986328125,"y":32.008075959291055},{"x":-1.1260986328125,"y":32.312670050625805},{"x":-0.85693359375,"y":32.312670050625805},{"x":-0.85693359375,"y":32.778037985363675},{"x":-1.065673828125,"y":32.778037985363675},{"x":-1.065673828125,"y":32.812670070909164},{"x":-1.27716064453125,"y":32.812670070909164},{"x":-1.27716064453125,"y":33.20422235093439},{"x":-1.50238037109375,"y":33.20422235093439},{"x":-1.50238037109375,"y":33.99802726234877},{"x":-1.5765380859375,"y":33.99802726234877},{"x":-1.5765380859375,"y":34.72355492704219},{"x":-1.69189453125,"y":34.72355492704219},{"x":-1.69189453125,"y":34.9805024453652},{"x":-1.9171142578125,"y":34.9805024453652},{"x":-1.9171142578125,"y":35.22318504970181},{"x":-2.46917724609375,"y":35.22318504970181},{"x":-2.46917724609375,"y":35.34649548039281},{"x":-2.801513671875,"y":35.34649548039281},{"x":-2.801513671875,"y":35.52552053465406},{"x":-3.1393432617187496,"y":35.52552053465406},{"x":-3.1393432617187496,"y":35.411438052435464},{"x":-3.57879638671875,"y":35.411438052435464},{"x":-3.57879638671875,"y":35.46961797120201},{"x":-4.07867431640625,"y":35.46961797120201},{"x":-4.07867431640625,"y":35.27925852568387},{"x":-4.40277099609375,"y":35.27925852568387},{"x":-4.40277099609375,"y":35.348735749472546},{"x":-4.7625732421875,"y":35.348735749472546},{"x":-4.7625732421875,"y":35.51434313431818},{"x":-4.89166259765625,"y":35.51434313431818},{"x":-4.89166259765625,"y":35.782170703266075},{"x":-5.14984130859375,"y":35.782170703266075},{"x":-5.14984130859375,"y":36.20882309283712},{"x":-4.8779296875,"y":36.20882309283712},{"x":-4.8779296875,"y":36.359374956015856},{"x":-4.163818359375,"y":36.359374956015856},{"x":-4.163818359375,"y":36.641977814705946},{"x":-1.8511962890624998,"y":36.641977814705946},{"x":-1.8511962890624998,"y":36.87742358748459},{"x":-1.461181640625,"y":36.87742358748459},{"x":-1.461181640625,"y":37.29153547292737},{"x":-1.197509765625,"y":37.29153547292737},{"x":-1.197509765625,"y":37.45959832290546},{"x":-0.50537109375,"y":37.45959832290546},{"x":-0.50537109375,"y":38.004819966413194},{"x":-0.33782958984375,"y":38.004819966413194},{"x":-0.33782958984375,"y":38.313645991657935},{"x":0.02197265625,"y":38.313645991657935},{"x":0.02197265625,"y":38.41055825094609},{"x":0.28564453125,"y":38.41055825094609},{"x":0.28564453125,"y":39.132190775931015},{"x":-0.07415771484375,"y":39.132190775931015},{"x":-0.07415771484375,"y":39.734650174341866},{"x":0.28564453125,"y":39.734650174341866},{"x":0.28564453125,"y":39.99395569397331},{"x":0.53009033203125,"y":39.99395569397331},{"x":0.53009033203125,"y":40.48455955508278},{"x":0.79925537109375,"y":40.48455955508278},{"x":0.79925537109375,"y":40.576412521044425},{"x":1.07666015625,"y":40.576412521044425},{"x":1.07666015625,"y":40.94671366508002},{"x":1.54083251953125,"y":40.94671366508002},{"x":1.54083251953125,"y":41.13729606112273},{"x":2.4609375,"y":41.13729606112273},{"x":2.4609375,"y":41.29431726315258},{"x":2.7410888671875,"y":41.29431726315258},{"x":2.7410888671875,"y":41.53531012183376},{"x":3.328857421875,"y":41.53531012183376},{"x":3.328857421875,"y":42.07376224008719},{"x":3.5815429687499996,"y":42.07376224008719},{"x":3.5815429687499996,"y":42.50247797334869},{"x":3.27667236328125,"y":42.50247797334869},{"x":3.27667236328125,"y":43.06086137134326},{"x":3.658447265625,"y":43.06086137134326},{"x":3.658447265625,"y":43.24320200099953},{"x":3.7957763671875,"y":43.24320200099953},{"x":3.7957763671875,"y":43.37111566864176},{"x":4.3890380859375,"y":43.37111566864176},{"x":4.3890380859375,"y":43.25320494908846},{"x":4.844970703125,"y":43.25320494908846},{"x":4.844970703125,"y":43.12103377575541},{"x":5.35858154296875,"y":43.12103377575541},{"x":5.35858154296875,"y":43.002638523957906},{"x":5.67169189453125,"y":43.002638523957906},{"x":5.67169189453125,"y":42.96044267380139},{"x":5.998535156249999,"y":42.96044267380139},{"x":5.998535156249999,"y":42.91419494510531},{"x":6.53961181640625,"y":42.91419494510531},{"x":6.53961181640625,"y":43.02071359427862},{"x":6.800537109375,"y":43.02071359427862},{"x":6.800537109375,"y":43.279204926082784},{"x":7.0751953125,"y":43.279204926082784},{"x":7.0751953125,"y":43.41701888881103},{"x":7.234497070312499,"y":43.41701888881103},{"x":7.234497070312499,"y":43.46687425474793},{"x":7.3828125,"y":43.46687425474793},{"x":7.3828125,"y":43.50872101129684},{"x":7.51739501953125,"y":43.50872101129684},{"x":7.51739501953125,"y":43.691707903073805},{"x":7.635498046875,"y":43.691707903073805},{"x":7.635498046875,"y":43.88997537383687},{"x":7.921142578125,"y":43.88997537383687},{"x":7.921142578125,"y":44.32384807250689},{"x":7.196044921875,"y":44.32384807250689},{"x":7.196044921875,"y":44.824708282300236},{"x":7.218017578125001,"y":44.824708282300236},{"x":7.218017578125001,"y":44.95702412512118},{"x":7.00927734375,"y":44.95702412512118},{"x":7.00927734375,"y":45.0657615477031},{"x":7.218017578125001,"y":45.0657615477031},{"x":7.218017578125001,"y":46.27103747280261},{"x":6.8994140625,"y":46.27103747280261},{"x":6.8994140625,"y":46.68713141244413},{"x":6.723632812499999,"y":46.68713141244413},{"x":6.723632812499999,"y":46.98774725646565},{"x":6.866455078125,"y":46.98774725646565},{"x":6.866455078125,"y":47.10752278534248},{"x":7.218017578125001,"y":47.10752278534248},{"x":7.218017578125001,"y":47.37603463349758},{"x":7.71240234375,"y":47.37603463349758},{"x":7.71240234375,"y":48.12943437745315},{"x":7.9541015625,"y":48.12943437745315},{"x":7.9541015625,"y":48.60385760823255},{"x":8.294677734375,"y":48.60385760823255},{"x":8.294677734375,"y":49.05227025601607},{"x":8.118896484375,"y":49.05227025601607},{"x":8.118896484375,"y":49.167338606291075},{"x":7.745361328125,"y":49.167338606291075},{"x":7.745361328125,"y":49.396675075193976},{"x":6.866455078125,"y":49.396675075193976},{"x":6.866455078125,"y":49.703167720179884},{"x":5.5810546875,"y":49.703167720179884},{"x":5.5810546875,"y":49.930008124606914},{"x":4.9658203125,"y":49.930008124606914},{"x":4.9658203125,"y":50.233151832472245},{"x":4.6142578125,"y":50.233151832472245},{"x":4.6142578125,"y":50.14170587960567},{"x":4.273681640625,"y":50.14170587960567},{"x":4.273681640625,"y":50.47848271564207},{"x":3.71337890625,"y":50.47848271564207},{"x":3.71337890625,"y":50.7295015014743},{"x":3.40576171875,"y":50.7295015014743},{"x":3.40576171875,"y":50.93766174471314},{"x":2.8564453125,"y":50.93766174471314}];
//define classes for GPC
var PolyDefault = gpcas.geometry.PolyDefault ;
var ArrayList = gpcas.util.ArrayList;
var PolySimple = gpcas.geometry.PolySimple;
var Clip = gpcas.geometry.Clip;
var OperationType = gpcas.geometry.OperationType;
var LmtTable = gpcas.geometry.LmtTable;
var ScanBeamTreeEntries = gpcas.geometry.ScanBeamTreeEntries;
var EdgeTable = gpcas.geometry.EdgeTable;
var EdgeNode = gpcas.geometry.EdgeNode;
var ScanBeamTree = gpcas.geometry.ScanBeamTree;
var Rectangle = gpcas.geometry.Rectangle;
var BundleState = gpcas.geometry.BundleState;
var LmtNode = gpcas.geometry.LmtNode;
var TopPolygonNode = gpcas.geometry.TopPolygonNode;
var AetTree = gpcas.geometry.AetTree;
var HState = gpcas.geometry.HState;
var VertexType = gpcas.geometry.VertexType;
var VertexNode = gpcas.geometry.VertexNode;
var PolygonNode = gpcas.geometry.PolygonNode;
var ItNodeTable = gpcas.geometry.ItNodeTable;
var StNode = gpcas.geometry.StNode;
var ItNode = gpcas.geometry.ItNode;



mode = 'none'; pt_tl = -1; pt_br = -1;
	
lat = 47; lng = 2; //France
zoom = 5;

//var map = L.map('map').setView([22.106, 20.56641], 18);
var map = L.map('map').setView([lat, lng], zoom);

L.tileLayer('http://otile1.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpg', {
	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

function toLeafletPolygon(poly) {/*
poly.addPoint(new Point(0, 0));
poly.addPoint(new Point(0, 45));

poly.addPoint(new Point(45, 45));
poly.addPoint(new Point(45, 0));*/
var coords =   [];

if(poly.isEmpty())
	return [];
var pts = poly.getPoints();

for(var i in pts) {
	coords.push([pts[i].y, pts[i].x]);
}
return coords;

}

poly = new PolyDefault();

for(var i in data) {
	poly.addPoint(new Point(data[i].x, data[i].y));
	//coords.push([pts[i].y, pts[i].x]);
}

poly_undo = poly;

polygon = L.polygon(toLeafletPolygon(poly)).addTo(map);

//errors = [];

	




var popup = L.popup();

function onMapClick(e) {
	
	if(mode != 'none') {
		if(pt_tl == -1) {
			pt_tl = e.latlng;
			}
		else if(pt_br == -1) {
			pt_br = e.latlng;
			polygonOperation();
			}
	}

	popup
		.setLatLng(e.latlng)
		.setContent("You clicked the map at " + e.latlng.toString())
		;//.openOn(map);
		//console.log(e)

}

map.on('click', onMapClick);
		
		
	
function init_mode () {
	document.getElementById('union').disabled = false;
	document.getElementById('diff').disabled = false;
	
	mode = 'none';
	pt_tl = -1;
	pt_br = -1;
}

init_mode();
document.getElementById('undo').disabled = true;
	
document.getElementById('union').onclick = function () {
	init_mode ();
	
	if(this.disabled) {
		this.disabled =	false;
		mode='none';
		}
	else {
		this.disabled =	true;
		mode='union';
		}

};

document.getElementById('diff').onclick = function () {
	init_mode ();
	
	if(this.disabled) {
		this.disabled =	false;
		mode='none';
		}
	else {
		this.disabled =	true;
		mode='diff';
		}

};
document.getElementById('undo').onclick = function () {

	poly = poly_undo;
	polygon.setLatLngs(toLeafletPolygon(poly));
	this.disabled = true;
	
};

function getPoint(index, offset) {
		
		var i = (parseInt(index) + parseInt(offset)) % poly.getNumPoints();
		if(i < 0)
			i += poly.getNumPoints();

		return poly.getPoint(i);
	}
	/*
function setPoint(index, offset, datum) {
		
		var i = (parseInt(index) + parseInt(offset)) % polygon_raw_path[0].length;
		if(i < 0)
			i += polygon_raw_path[0].length;

		polygon_raw_path[0][i] = datum;
	}
/*	
function optiPolygon() {
	new_polygon = [];
	
	correction = false;
	
	for(var n in polygon_raw_path[0]) {
		
		if(!correction) {
		
			a = getPoint(n,-1);
			i = getPoint(n, 0);
			z = getPoint(n,+1);
			
			if((a.X == i.X && i.X == z.X) || (a.Y == i.Y && i.Y == z.Y)) {
				correction = true;
				continue;
				}
			else {
				new_polygon.push(i);
				}
			}
		else {
			new_polygon.push(i);
			}
		
		}
		
	polygon_raw_path[0] = [new_polygon];
		
	if(correction)
		optiPolygon();
	
}
	
function debug_fix(n) {

	a = getPoint(n,-1);
	i = getPoint(n, 0);
	z = getPoint(n,+1);
	
	ayr = Math.abs(a.Y - i.Y);
	zyr = Math.abs(z.Y - i.Y);
	
	if(ayr < zyr) {
		ypt = a;
		xpt = z;
	}
	else {
		ypt = z;
		xpt = a;
	}
	
	setPoint(n, 0, {X: xpt.X, Y: ypt.Y});
	
	polygon.setLatLngs(toLeafletPolygon(polygon_raw_path));
	
	loopError();
}
	*/
function loopError() {
//p = getPoint(0);
console.log(p);
/*		for( e in errors) {
			 console.log(errors[e].marker);
			map.removeLayer(errors[e].marker);
		}
		
		errors = [];
		
		for(var n in polygon_raw_path[0]) {
			
			a = getPoint(n,-1);
			i = getPoint(n, 0);
			z = getPoint(n,+1);
			
			console.log((a.Y == i.Y && i.X == z.X), (a.X == i.X && i.Y == z.Y))

			if(!(a.Y == i.Y && i.X == z.X) && !(a.X == i.X && i.Y == z.Y)) {
				
				marker = L.marker([i.Y, i.X]).addTo(map);
				marker.bindPopup('<button onclick="debug_fix('+n+');">Fix</button>');
				
				errors.push({n : n, marker : marker});
				
				
			}
			
			
		
		}

		if(errors.length == 0 && mode == "export") {
			alert(JSON.stringify(polygon_raw_path[0]));
			init_mode();
			
			}	*/
	}
/*
function aloopError() {
getError();

	
}
*/
document.getElementById('export').onclick = function () {

	if(!poly.isEmpty()) {
		pts = poly.getPoints();	
	error = 0;
		for(var n in pts) {
			
			a = getPoint(n,-1);
			i = getPoint(n, 0);
			z = getPoint(n,+1);
			
			if(!(a.y == i.y && i.x == z.x) && !(a.x == i.x && i.y == z.y)) {
				marker = L.marker([i.y, i.x]).addTo(map);
				error++;
				}
				

			}
	
	alert(error + " erreur(s) durant la génération");
	
	var myBlob = new Blob([JSON.stringify(poly.getPoints())], {type : "text/json"});
	window.location = window.URL.createObjectURL(myBlob);
	}
	//mode_init();
	

	
};

/*
*/
function polygonOperation () {


if(mode == 'union' || mode == 'diff') {



	poly_undo = poly;
	document.getElementById("undo").disabled = false;
	
	selection_poly =  new PolyDefault();
		
		selection_poly.addPoint(new Point(pt_tl.lng, pt_tl.lat));
		selection_poly.addPoint(new Point(pt_br.lng, pt_tl.lat));
		selection_poly.addPoint(new Point(pt_br.lng, pt_br.lat));
		selection_poly.addPoint(new Point(pt_tl.lng, pt_br.lat));
	

	if(mode == 'union') {
	
		if(poly.isEmpty())
			solution_poly = selection_poly;
		else
			solution_poly = poly.union(selection_poly);
	}
	else {
		solution_poly = poly.difference(selection_poly);	
	}

		
	poly = solution_poly;

	polygon.setLatLngs(toLeafletPolygon(poly));
	


	loopError();
}

init_mode ();
}


	</script>
</body>
</html>
